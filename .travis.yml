language: java

jdk:
  - openjdk8

script:
  - mvn test -B
  - mvn org.pitest:pitest-maven:mutationCoverage

before_deploy:
  - POM_VERSION=$(mvn -q -Dexec.executable=echo -Dexec.args='${project.version}' --non-recursive exec:exec)

# Releases config copied from https://docs.travis-ci.com/user/deployment/releases/ and secure key generated by following
# https://stackoverflow.com/questions/25302518/travis-ci-setup-releases-with-github-token#answer-57032190
deploy:
  provider: releases
  api_key:
    secure: lS7XfqB3s1eNQnM8ABRkAij5L42x7gd7ZZ+7wQcLaTz+++kl4IR5nPQThvzaeCi9siQiO7N+L51mk+l8U2ToL+vQ3S25IG6sRfJ5PzFWnTxS9JUJ3WDFsegkrJ5jpY+Mb6hjT7D6aCGH/jTy2HvxSHVVEGgZk9EOn9PO05C8dBXu/CsBT21PhYaBNNnrMsIvY6SnlTCtUeWdWCUGoqaZ7/xtYuofwSYrF68LaI/QoHfcZiAYzr9OZSVV+SRT+ph1PvvYDB2Cyv2FBdFrjr31uezKtNiF7CzCU3SwjdY3G7ta75H+1gg6bAOb6IjfObnY2x+ZVTozMTtq3rki7phV7qNTAeFPD61yOWij1crypa3pKNXHgcq+wqA6JhAIuyvtwvPcdn2y3kQ0cotMA5gDLCxQYTcGEkJ5u8vP5TD9EMYHyiNXNgCAwBOgbC72qZFfMt5IVOlyym34emJfJcUDgcFup/jt79lIjE2ov2Rer5Q3JzR8UcVGvjNZxqYxuR3OPV+3/DmcddI6/rGKn83HUJBDX6Mji30edZhwJVjQnp9OYxJNyTXZFTsh6HZqXc3nZcsb8DDXIOUcxQzTKYEUM9CBNKSrkshGJ+gAVvF4Vwh2iy503Wv6SlLXq27pyHLpxZCGQYLv3KOAdSFjwvlx+HARatz33ghzQDeeIuppwVY=
  file:
    - "spt-development-audit-spring-boot-autoconfigure/target/spt-development-audit-spring-boot-autoconfigure-${POM_VERSION}.jar"
    - "spt-development-audit-spring-boot-starter/target/spt-development-audit-spring-boot-starter-${POM_VERSION}.jar"
  skip_cleanup: true
  on:
    tags: true
